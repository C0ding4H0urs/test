"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6743],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return b}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),m=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=m(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=m(t),c=o,b=p["".concat(l,".").concat(c)]||p[c]||u[c]||a;return t?r.createElement(b,i(i({ref:n},d),{},{components:t})):r.createElement(b,i({ref:n},d))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=c;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var m=2;m<a;m++)i[m]=t[m];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},6694:function(e,n,t){t.r(n),t.d(n,{assets:function(){return l},contentTitle:function(){return i},default:function(){return u},frontMatter:function(){return a},metadata:function(){return s},toc:function(){return m}});var r=t(3117),o=(t(7294),t(3905));const a={title:"Emote Filter"},i=void 0,s={unversionedId:"moderation/emote-filter",id:"moderation/emote-filter",title:"Emote Filter",description:"Triggers on emoji-only message chains and punishes the user.",source:"@site/docs/moderation/emote-filter.md",sourceDirName:"moderation",slug:"/moderation/emote-filter",permalink:"/moderation/emote-filter",draft:!1,editUrl:"https://github.com/yagpdb-cc/yagpdb-cc/edit/master/website/docs/moderation/emote-filter.md",tags:[],version:"current",frontMatter:{title:"Emote Filter"},sidebar:"sidebar",previous:{title:"Reaction Handler",permalink:"/moderation/report-system/reaction-handler"},next:{title:"Lockdown",permalink:"/moderation/lockdown"}},l={},m=[{value:"Trigger",id:"trigger",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Code",id:"code",level:2},{value:"Author",id:"author",level:2}],d={toc:m},p="wrapper";function u(e){let{components:n,...t}=e;return(0,o.kt)(p,(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Triggers on emoji-only message chains and punishes the user."),(0,o.kt)("p",null,'More specifically, this command will allow a set number of emote-only messages to go through before deleting subsequent messages and tracking them in a log channel.\nIt uses a rolling time frame: every time the filter catches an emote-only message, the automod length is refreshed.\nThe regex trigger will capture any number of emotes in a row and with up to 2 characters on each side to prevent bypassing automod (such as an emote followed by a single period) but has enough wiggle room to allow a message such as "LOL :kek:".'),(0,o.kt)("p",null,"You have the option to enable an automatic emote ban function based on assigning a role to the user, which will delete all emote-only messages for the duration of their ban rather than counting towards the filter.\nWe recommend disabling the ",(0,o.kt)("inlineCode",{parentName:"p"},"Use External Emoji")," permission as an added incentive for nitro users to not get themselves emote banned."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"YAGPDB cannot detect message edits; thus, users are able to send messages and then edit them to single emotes bypassing the filter.\nThere is nothing that can be done about this so it's not an issue of this command.")),(0,o.kt)("h2",{id:"trigger"},"Trigger"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Type:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"Regex"),(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"Trigger:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"^.{0,2}(((<a?:[\\w~]{2,32}:\\d{17,19}>)|[\\x{1f1e6}-\\x{1f1ff}]{2}|\\p{So}\\x{fe0f}?[\\x{1f3fb}-\\x{1f3ff}]?(\\x{200D}\\p{So}\\x{fe0f}?[\\x{1f3fb}-\\x{1f3ff}]?)*|[#\\d*]\\x{FE0F}?\\x{20E3}).{0,2}|\\s+)+$")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$length"),(0,o.kt)("br",null),"\nDuration of auto delete, in seconds.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$emoteDelete"),(0,o.kt)("br",null),"\nNumber of emotes allowed before deletion.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$logEnable"),(0,o.kt)("br",null),"\nWhether or not logging is enabled.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\ud83d\udccc ",(0,o.kt)("inlineCode",{parentName:"p"},"$logChannel"),(0,o.kt)("br",null),"\nChannel to send logs. Only applies if ",(0,o.kt)("inlineCode",{parentName:"p"},"$logEnable")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$banEnable"),(0,o.kt)("br",null),"\nWhether or not emote bans are enabled.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\ud83d\udccc ",(0,o.kt)("inlineCode",{parentName:"p"},"$banRole"),(0,o.kt)("br",null),"\nRole ID of the emote ban role.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$banTime"),(0,o.kt)("br",null),"\nEmote ban duration in seconds.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$banNum"),(0,o.kt)("br",null),"\nNumber of emotes from a single user permitted before an emote ban.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$banWarn"),(0,o.kt)("br",null),"\nNumber of emotes from a single user before sending a warning in DM. Use ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," to disable.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"$banMsg"),(0,o.kt)("br",null),"\nWhether or not you have ",(0,o.kt)("inlineCode",{parentName:"p"},"Use External Emoji")," permissions disabled in channels."))),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-gotmpl",metastring:"file=../../../src/moderation/emote_filter.go.tmpl",file:"../../../src/moderation/emote_filter.go.tmpl"},'{{/*\n    Triggers on emoji-only message chains and punishes the user.\n    See <https://yagpdb-cc.github.io/moderation/emote-filter> for more information.\n\n    Author: DV0RAK <https://github.com/dvoraknt/>\n*/}}\n\n{{/* Configurable values */}}\n{{$length := 120}}\n{{$emoteDelete := 3}}\n\n{{$logEnable := true}}\n{{$logChannel := 503913846684123166}}\n\n{{$banEnable := true}}\n{{$banRole := 539502463649185794}}\n{{$banTime := 3600}}\n{{$banNum := 5}}\n{{$banWarn := 3}}\n{{$banMsg := true}}\n{{/* End of configurable values */}}\n\n{{/* ===============================DO NOT TOUCH=============================== */}}\n{{$x := ""}}\n{{$spammers := ""}}\n{{$spammerList := ""}}\n{{$spammersdict := ""}}\n\n{{if hasRoleID $banRole}}\n    {{deleteTrigger 0}}\n{{end}}\n\n{{if and (dbGet .Channel.ID "cooldown") (not (hasRoleID $banRole))}}\n    {{if eq (dbIncr .Channel.ID "emoteCount" 1|toInt) $emoteDelete}}\n        {{dbSetExpire .Channel.ID "cooldown" "cooldown" $length}}\n        {{if $logEnable}}{{$x = sendMessageRetID $logChannel (print "Emote filter triggered in <#" .Channel.ID ">")}}{{end}}\n        {{dbSetExpire .Channel.ID "messageID" ($x|toString) $length}}\n\n        {{$spammersdict := sdict (dbGet .Channel.ID "spammers").Value}}\n        {{if $count := $spammersdict.Get (str .User.ID)}}\n            {{$count = add $count 1}}\n            {{$spammersdict.Set (str .User.ID) $count}}\n            {{if and $banEnable (eq $count $banWarn)}}{{sendDM "You have sent (" $banWarn ") emote only messages in a short time period, if you continue sending these messages you will have your permissions revoked. To keep channels conversation focused please limit single emote uses to reactions or incorporated into other messages."}}{{end}}\n            {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n        {{else}}\n            {{$spammersdict.Set (str .User.ID) 1}}\n            {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n        {{end}}\n\n    {{range $k, $v := $spammersdict}}\n        {{- $spammerList = joinStr "\\n" $spammerList (printf "<@%s> - %s" $k (str $v)) -}}\n    {{end}}\n\n    {{if $logEnable}}{{editMessage $logChannel $x (cembed "title" "Emotes Filtered" "description" $spammerList)}}{{end}}\n    {{dbSetExpire .Channel.ID "messageID" ($x|toString) $length}}\n\n    {{else if lt (dbIncr .Channel.ID "emoteCount" 1|toInt) $emoteDelete}}\n        {{dbSetExpire .Channel.ID "cooldown" "cooldown" $length}}\n        {{$spammersdict := sdict (dbGet .Channel.ID "spammers").Value}}\n            {{if $count := $spammersdict.Get (str .User.ID)}}\n                {{$count = add $count 1}}\n                {{$spammersdict.Set (str .User.ID) $count}}\n                {{if and $banEnable (eq $count $banWarn)}}{{sendDM "You have sent (" $banWarn ") emote only messages in a short time period, if you continue sending these messages you will have your permissions revoked. To keep channels conversation focused please limit single emote uses to reactions or incorporated into other messages."}}{{end}}\n                {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n            {{else}}\n                {{$spammersdict.Set (str .User.ID) 1}}\n                {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n            {{end}}\n\n    {{else if gt (dbIncr .Channel.ID "emoteCount" 1|toInt) $emoteDelete}}\n        {{deleteTrigger 0}}{{dbSetExpire .Channel.ID "cooldown" "cooldown" $length}}\n        {{$x = (dbGet .Channel.ID "messageID").Value|toString}}\n\n        {{$spammersdict := sdict (dbGet .Channel.ID "spammers").Value}}\n        {{if $count := $spammersdict.Get (str .User.ID)}}\n            {{$count = add $count 1}}\n            {{$spammersdict.Set (str .User.ID) $count}}\n            {{if and $banEnable (eq $count $banWarn)}}{{sendDM "You have sent (" $banWarn ") emote only messages in a short time period, if you continue sending these messages you will have your permissions revoked. To keep channels conversation focused please limit single emote uses to reactions or incorporated into other messages."}}{{end}}\n            {{if and (ge $count $banNum) ($banEnable)}}\n                {{addRoleID $banRole}}\n                {{removeRoleID $banRole $banTime}}\n                {{$spammersdict.Set (str .User.ID) (print $banNum " - User has been emote banned.")}}\n                {{$banMin := div $banTime 60}}\n                {{if $banMsg}}\n                    {{sendDM "You have been emote banned for " $banMin " minutes. You will not be able to use external emotes (if you are a nitro user) and will not be able to send emote-only messages during this time."}}\n                {{else}}\n                    {{sendDM "You have been emote banned for " $banMin " minutes. You will not be able to send emote-only messages during this time."}}\n                {{end}}\n            {{end}}\n        {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n    {{else}}\n        {{$spammersdict.Set (str .User.ID) 1}}\n        {{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n    {{end}}\n\n\n    {{range $k, $v := $spammersdict}}\n        {{- $spammerList = joinStr "\\n" $spammerList (printf "<@%s> - %s" $k (str $v)) -}}\n    {{end}}\n\n    {{if $logEnable}}{{editMessage $logChannel $x (cembed "title" "Emotes Filtered" "description" $spammerList)}}{{end}}\n    {{dbSetExpire .Channel.ID "messageID" ($x|toString) $length}}\n    {{end}}\n{{else if not (hasRoleID $banRole)}}\n\n{{dbSetExpire .Channel.ID "cooldown" "cooldown" $length}}\n{{dbDel .Channel.ID "emoteCount"}}\n\n{{$spammersdict = sdict (str .User.ID) 1}}\n{{dbSetExpire .Channel.ID "spammers" $spammersdict $length}}\n\n\n{{end}}\n')),(0,o.kt)("h2",{id:"author"},"Author"),(0,o.kt)("p",null,"This custom command was written by ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dvoraknt"},"@dvoraknt"),"."))}u.isMDXComponent=!0}}]);