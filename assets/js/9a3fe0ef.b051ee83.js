"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2981],{3905:function(e,t,r){r.d(t,{Zo:function(){return l},kt:function(){return f}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),p=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},l=function(e){var t=p(e.components);return n.createElement(u.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,l=a(e,["components","mdxType","originalType","parentName"]),c=p(r),m=o,f=c["".concat(u,".").concat(m)]||c[m]||d[m]||i;return r?n.createElement(f,s(s({ref:t},l),{},{components:r})):n.createElement(f,s({ref:t},l))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,s=new Array(i);s[0]=m;var a={};for(var u in t)hasOwnProperty.call(t,u)&&(a[u]=t[u]);a.originalType=e,a[c]="string"==typeof e?e:o,s[1]=a;for(var p=2;p<i;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6047:function(e,t,r){r.r(t),r.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return i},metadata:function(){return a},toc:function(){return p}});var n=r(3117),o=(r(7294),r(3905));const i={title:"Custom Report"},s=void 0,a={unversionedId:"moderation/report-system/custom-report",id:"moderation/report-system/custom-report",title:"Custom Report",description:"This command is basically equivalent to the built-in report command, but has some back-end changes in order for the rest of the custom report system to work.",source:"@site/docs/moderation/report-system/custom-report.md",sourceDirName:"moderation/report-system",slug:"/moderation/report-system/custom-report",permalink:"/moderation/report-system/custom-report",draft:!1,editUrl:"https://github.com/yagpdb-cc/yagpdb-cc/edit/master/website/docs/moderation/report-system/custom-report.md",tags:[],version:"current",frontMatter:{title:"Custom Report"},sidebar:"sidebar",previous:{title:"Cancel Report",permalink:"/moderation/report-system/cancel-report"},next:{title:"Reaction Handler",permalink:"/moderation/report-system/reaction-handler"}},u={},p=[{value:"Trigger",id:"trigger",level:2},{value:"Usage",id:"usage",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Code",id:"code",level:2},{value:"Author",id:"author",level:2}],l={toc:p},c="wrapper";function d(e){let{components:t,...r}=e;return(0,o.kt)(c,(0,n.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This command is basically equivalent to the built-in report command, but has some back-end changes in order for the rest of the custom report system to work."),(0,o.kt)("p",null,"For more information about the custom report system, see ",(0,o.kt)("a",{parentName:"p",href:"overview"},"this")," page."),(0,o.kt)("h2",{id:"trigger"},"Trigger"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Type:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"Regex"),(0,o.kt)("br",null),"\n",(0,o.kt)("strong",{parentName:"p"},"Trigger:")," ",(0,o.kt)("inlineCode",{parentName:"p"},"\\A-r(eport)?(?:u(ser)?)?(\\s+|\\z)")),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-ru <user> <reason>")," - Reports the user provided using the reason given.")),(0,o.kt)("admonition",{title:"Aliases",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"ru"),", you can also use ",(0,o.kt)("inlineCode",{parentName:"p"},"reportuser"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"reportu"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"ruser"),".")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\ud83d\udccc ",(0,o.kt)("inlineCode",{parentName:"p"},"$REPORT_LOG"),(0,o.kt)("br",null),"\nThe channel where reports are sent to.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\ud83d\udccc ",(0,o.kt)("inlineCode",{parentName:"p"},"$REPORT_DISCUSSION"),(0,o.kt)("br",null),"\nThe channel where users are notified of updates regarding their report."))),(0,o.kt)("h2",{id:"code"},"Code"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-gotmpl",metastring:"file=../../../../src/moderation/report_system/custom_report.go.tmpl",file:"../../../../src/moderation/report_system/custom_report.go.tmpl"},'{{/*\n    Replacement for the built-in report command that integrates with the custom report system.\n    See <https://yagpdb-cc.github.io/moderation/report-system/custom-report> for more information.\n\n    Author: Luca Z. <https://github.com/l-zeuch>\n*/}}\n\n{{/* Configurable values */}}\n{{$REPORT_LOG := 123}}\n{{$REPORT_DISCUSSION := 234}}\n{{/* End of configurable values */}}\n\n{{/* ACTUAL CODE */}}\n{{$Escaped_Prefix := reQuoteMeta .ServerPrefix}}\n{{if not (reFind (print `\\A` $Escaped_Prefix `|<@!?204255221017214977>`) .Message.Content)}}\nDid not set regex to match Server Prefix!{{deleteTrigger}}\n{{else}}\n{{if and .CmdArgs (lt (len .CmdArgs) 2)}}\n    {{if eq (index .CmdArgs 0) "dbSetup"}}\n        {{if hasPermissions .Permissions.ManageServer}}\n            {{dbSet .Guild.ID "reportSettings" (sdict "reportLog" $REPORT_LOG "reportDiscussion" $REPORT_DISCUSSION)}}\n            {{dbSet .Guild.ID "ReportNo" 0}}\n**Database primed, report count reset, system is ready to use!**\n        {{else}}\nYou do not have permission to use this command!\n        {{end}}\n    {{else}}\n    {{sendMessage nil (printf "```%s <User:Mention/ID> <Reason:Text>``` \\n Not enough arguments passed." .Cmd)}}\n    {{end}}\n{{else if not .CmdArgs}}\n    {{sendMessage nil (printf "```%s <User:Mention/ID> <Reason:Text>``` \\n Not enough arguments passed." .Cmd)}}\n{{else}}\n    {{$user := userArg (index .CmdArgs 0)}}\n    {{if eq $user.ID .User.ID}}\nYou can\'t report yourself, silly.{{deleteTrigger}}\n    {{else}}\n        {{$secret := adjective}}\n        {{$logs250 := execAdmin "log 250"}}\n        {{$reason := joinStr " " (slice .CmdArgs 1)}}\n        {{$history := ""}}\n        {{if (dbGet $user.ID "rhistory")}}\n            {{range (dbGetPattern $user.ID "rhistory%" 7 0)}}\n                {{$history = .Value}}\n            {{end}}\n            {{dbSet $user.ID "rhistory" (print (dbGet $user.ID "rhistory").Value "\\n" (currentTime.Format "02-01-2006-15:04:05") ": " $reason)}}\n        {{else}}\n            {{dbSet $user.ID "rhistory" (print (currentTime.Format "02-01-2006-15:04:05") ": " $reason)}}\n        {{end}}\n        {{$reportNo := dbIncr 2000 "ReportNo" 1}}\n        {{$reportEmbed := cembed "title" (print "Report No. " $reportNo)\n            "author" (sdict "name" (printf "%s (ID %d)" .User.String .User.ID) "icon_url" (.User.AvatarURL "256"))\n            "thumbnail" (sdict "url" ($user.AvatarURL "512"))\n            "description" (printf "<@%d> reported <@%d> in <#%d>." .User.ID $user.ID .Channel.ID)\n            "fields" (cslice\n                (sdict "name" "Current State" "value" "__Not reviewed yet.__")\n                (sdict "name" "Reason for Report" "value" $reason)\n                (sdict "name" "Reported user" "value" (printf "<@%d> (ID %d)" $user.ID $user.ID))\n                (sdict "name" "Message Logs" "value" (printf "[last 250 messages](%s) \\nTime - `%s`" $logs250 (currentTime.Format "Mon 02 Jan 15:04:05")))\n                (sdict "name" "History" "value" (print "```\\n" (or $history "None recorded") "\\n```"))\n                (sdict "name" "Reaction Menu Options" "value" (printf "\\nDismiss report with \u274c, start investigation with \ud83d\udee1\ufe0f, or ask for more background information with \u26a0\ufe0f."))\n            )\n            "footer" (sdict "text" "No moderator yet \u2022 Claim by reacting with \ud83d\udd10")\n        }}\n        {{$x := sendMessageRetID $REPORT_LOG $reportEmbed}}\n        {{addMessageReactions $REPORT_LOG $x "\ud83d\udd10"}}\nUser reported to the proper authorites!\n        {{dbSet .User.ID "key" $secret}}\n        {{if not .Message.Mentions}}\n        {{deleteTrigger}}\n        {{end}}\n        {{sendDM (printf "User reported to the proper authorities! If you wish to cancel your report, simply type \\n```-cancelr %d %s``` in any channel.\\n **A reason is required.**" $x $secret)}}\n{{end}}{{end}}{{end}}\n{{deleteResponse}}\n')),(0,o.kt)("h2",{id:"author"},"Author"),(0,o.kt)("p",null,"This custom command was written by ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/l-zeuch"},"@l-zeuch"),"."))}d.isMDXComponent=!0}}]);